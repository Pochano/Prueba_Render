<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Economía Familiar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h1>Bienvenido, {{ usuario }}</h1>
    {% if mensaje %}
        <p style="color:red;">{{ mensaje }}</p>
    {% endif %}

    <h2>Agregar Movimiento</h2>
    <form method="post">
        <label>Tipo:</label>
        <select name="tipo" id="tipo" onchange="actualizarConceptos()">
            <option value="ingreso">Ingreso</option>
            <option value="gasto">Gasto</option>
        </select>

        <label>Concepto:</label>
        <select name="concepto" id="concepto"></select>

        <label>Monto:</label>
        <input type="number" step="0.01" name="monto" required>

        <button type="submit">Agregar</button>
    </form>

    <h2>Resumen</h2>
    <div class="balance-summary">
        <div class="ingresos">Total Ingresos: {{ detalle.total_ingresos }}</div>
        <div class="gastos">Total Gastos: {{ detalle.total_gastos }}</div>
        <div class="total">Balance: {{ detalle.balance }}</div>
    </div>

    <h3>Ingresos</h3>
    <ul>
        {% for i in detalle.ingresos %}
            <li>{{ i.concepto }}: {{ i.monto }}</li>
        {% endfor %}
    </ul>

    <h3>Gastos</h3>
    <ul>
        {% for g in detalle.gastos %}
            <li>{{ g.concepto }}: {{ g.monto }}</li>
        {% endfor %}
    </ul>

    <a href="/logout">Cerrar Sesión</a>
</div>

<script>
const conceptos_gasto = JSON.parse('{{ conceptos_gasto | tojson | safe }}');
const conceptos_ingreso = JSON.parse('{{ conceptos_ingreso | tojson | safe }}');

function actualizarConceptos() {
    const tipo = document.getElementById('tipo').value;
    const select = document.getElementById('concepto');
    select.innerHTML = '';
    const lista = tipo === 'ingreso' ? conceptos_ingreso : conceptos_gasto;
    lista.forEach(c => {
        const option = document.createElement('option');
        option.value = c;
        option.text = c;
        select.add(option);
    });
}

window.onload = actualizarConceptos;


window.onunload = function() {
    navigator.sendBeacon("/logout");
};


</script>
</body>
</html>